# SAM3D Debug Record

**Why did the render produce a table instead of a bottle?**

**Status: Bug Located**

---

## Problem Symptoms

Used VIGA to call SAM3D to reconstruct a green tea bottle, but the Blender render result was a flat "table" shape instead of a bottle.

### Expected Result

![Expected](test_results_images/02_greentea_output.png)

Should be a 3D model of a green tea bottle

### Actual Result

![Actual](test_results_images/green_tea_bottle_viga_render.png)

Rendered as a flat table shape

---

## Root Cause

> **Wrong input image!**
>
> The `green_tea_bottle.png` we used was an **inverted mask** -- it displayed the table background, with the bottle area cut out.
>
> So SAM3D reconstructed the **table**, not the bottle!

### Wrong Input (inverted mask)

![Wrong Input](../output/test_sam/green_tea_bottle.png)

`output/test_sam/green_tea_bottle.png` -- Only the table, bottle was cut out

### Correct Input

![Correct Input](../output/test_sam/ito_en_green_tea_bottle.png)

`output/test_sam/ito_en_green_tea_bottle.png` -- Correct bottle image

---

## Mesh Analysis Verification

By inspecting the geometry data of the GLB file, we confirmed the mesh is indeed flat:

```
[glb] type: trimesh.base.Trimesh
  vertices: (118684, 3)
  X range: -0.50 to +0.50  (width ~1.0)
  Y range: -0.12 to +0.11  (thickness ~0.23) <-- Very thin!
  Z range: -0.21 to +0.21  (height ~0.42) <-- Also thin
```

The Y and Z dimensions are much smaller than X, proving this is a nearly planar structure -- consistent with the shape characteristics of a "tabletop".

---

## Solution

> **Use the correct input files**

| File Type | Correct Path |
|---|---|
| Original Image | `docs/test_results_images/01_greentea_input.jpg` |
| Segmented Bottle | `output/test_sam/ito_en_green_tea_bottle.png` |
| Corresponding Mask | `output/test_sam/ito_en_green_tea_bottle.npy` |

### Correct Run Command

```powershell
conda run -n sam3d_py311 python "tools\sam3d\sam3d_worker.py" `
    --image "output\test_sam\ito_en_green_tea_bottle.png" `
    --mask  "output\test_sam\ito_en_green_tea_bottle.npy" `
    --config "utils\third_party\sam3d\checkpoints\hf\checkpoints\pipeline.yaml" `
    --glb   "output\viga_test\ito_en_bottle_correct.glb"
```

---

## Conclusion

- **SAM3D itself has no issues** -- it correctly reconstructed the object in the input image
- **Disabled mesh post-processing is not the main cause** -- even a 2.5D mesh should approximate the bottle shape
- **The problem was in the data preparation stage** -- the wrong (inverted) mask image was used
- **Lesson learned**: Always check that the input image is correct before running!

---

## To Do

- Re-run SAM3D using the correct bottle image
- Verify that the output mesh has a bottle shape
- Render the correct result in Blender

---

Debug date: 2026-02-03 03:51 - 04:01 PST

*-- Created by Yuna*
