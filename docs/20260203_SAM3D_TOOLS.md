# SAM3D Tools Reference

**Command-line tools for SAM3D workflow: generation, visualization, and post-processing**

---

## Tool Overview

| Tool | Purpose | Input | Output |
|---|---|---|---|
| `sam3d_worker.py` | Run SAM3D inference | Image + Mask + Config | GLB mesh |
| `downsample_pointcloud.py` | Reduce point count | GLB/PLY | PLY |
| `render_pointcloud.py` | Quick preview (Open3D) | GLB/PLY | PNG |
| `blender_render_rotation.py` | High-quality rotation render | GLB | PNG frames |
| `create_gifs.py` | Create ping-pong GIFs | PNG frames | GIF |

---

## SAM3D Inference

### sam3d_worker.py

**Path:** `tools/sam3d/sam3d_worker.py`

Run SAM3D (TRELLIS) to generate 3D mesh from image + mask.

### Usage

```powershell
$env:PYTHONPATH = "D:\Projects\ProjectGenesis\GenesisVIGA"
conda run -n sam3d_py311 python tools/sam3d/sam3d_worker.py `
    --image "input.png" `
    --mask "mask.npy" `
    --config "utils/third_party/sam3d/checkpoints/hf/checkpoints/pipeline.yaml" `
    --glb "output.glb"
```

### Arguments

| Argument | Description |
|---|---|
| `--image` | Input RGB image (PNG) |
| `--mask` | Binary mask (NPY or PNG) |
| `--config` | Pipeline config YAML |
| `--glb` | Output GLB path |

### Environment

```
Conda: sam3d_py311
Python: 3.11.14
PyTorch: 2.8.0+cu128
CUDA: 12.8
```

---

## Point Cloud Processing

### downsample_pointcloud.py

**Path:** `tools/downsample_pointcloud.py`

Reduce point count using voxel, uniform, or random downsampling.

### Usage

```bash
# View point cloud info
python tools/downsample_pointcloud.py input.glb --info

# Voxel downsample (merge nearby points)
python tools/downsample_pointcloud.py input.glb --voxel 0.01 -o output.ply

# Uniform downsample (keep every Nth point)
python tools/downsample_pointcloud.py input.glb --uniform 2 -o output.ply

# Random downsample (keep X%)
python tools/downsample_pointcloud.py input.glb --random 0.5 -o output.ply
```

### Downsample Methods

| Method | Parameter | Effect |
|---|---|---|
| Voxel | `--voxel 0.01` | Merge points within 0.01 unit voxels |
| Uniform | `--uniform 4` | Keep every 4th point (25%) |
| Random | `--random 0.3` | Randomly keep 30% of points |

---

## Visualization

### render_pointcloud.py (Open3D - Fast Preview)

**Path:** `tools/render_pointcloud.py`

Quick point cloud rendering using Open3D. Good for fast previews.

```bash
# Single view
python tools/render_pointcloud.py input.ply --view front -o output.png

# Multiple preset views
python tools/render_pointcloud.py input.ply --all-views --output-dir renders/

# Views: front, back, left, right, top, bottom, iso, iso2, iso3, iso4
```

### blender_render_rotation.py (Blender - High Quality)

**Path:** `tools/blender_render_rotation.py`

High-quality rotation animation using Blender Cycles. **Rotates object, not camera** (avoids gimbal lock).

```bash
# Render 30 frames per axis
blender --background --python tools/blender_render_rotation.py -- input.glb output_dir --frames 30
```

### Key Technique: Rotate Object, Not Camera

| Approach | Result |
|---|---|
| Rotate camera position | Gimbal lock at top/bottom |
| Track-To constraint | Sudden angle jumps |
| Rotate object with quaternion | Smooth 360 degree rotation |

### create_gifs.py

**Path:** `tools/create_gifs.py`

Create ping-pong GIFs (1-->30-->1) from rendered frames.

```bash
python tools/create_gifs.py output_dir
```

---

## Complete Workflow

```powershell
# 1. Run SAM3D to generate GLB
$env:PYTHONPATH = "D:\Projects\ProjectGenesis\GenesisVIGA"
conda run -n sam3d_py311 python tools/sam3d/sam3d_worker.py `
    --image input.png --mask mask.npy `
    --config utils/third_party/sam3d/checkpoints/hf/checkpoints/pipeline.yaml `
    --glb output.glb

# 2. Render rotation animation with Blender
blender --background --python tools/blender_render_rotation.py -- output.glb renders/ --frames 30

# 3. Create GIFs
python tools/create_gifs.py renders/

# Output:
#   renders/{name}_y_rotation.gif  (turntable)
#   renders/{name}_x_rotation.gif  (tumble)
```

---

## Related Documentation

- [SAM3D Internals](20260203_SAM3D_INTERNALS.html) - Pipeline stages, parameters, VRAM optimization
- [VIGA Architecture](20260203_VIGA_ARCHITECTURE.html) - VIGA --> SAM3D --> TRELLIS hierarchy
- [SAM3D Bottle Test](20260203_SAM3D_BOTTLE_TEST.html) - Successful test results

---

Created: 2026-02-03 19:54 PST
Author: Yuna
