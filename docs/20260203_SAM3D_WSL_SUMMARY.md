# SAM3D Experience Summary (WSL)

*VIGA Project Experience Summary -- February 3, 2026 | Environment: WSL (Ubuntu on Windows)*

## Core Conclusion

SAM3D **can run small images** (<=1024px) on RTX 5080 (16GB), but **large images will OOM**. The key is to only generate Gaussian Splat and skip Mesh generation.

## Successful Parts

### 1. Small Image Test Passed (771x1024)

**PASSED** -- Green tea bottle image fully completed Stage 1-3

```
result/2026-02-01_greentea_sam3d_v2/
├── input.jpg              # Input image (771x1024)
├── greentea_mask.png      # Segmentation mask
└── greentea_splat_v2.ply  # 25MB Gaussian Splat output
```

| Stage | Name | Status | Time |
|-------|------|--------|------|
| 1 | Sparse Structure | Pass | ~10s |
| 2 | SLAT Sampling | Pass | ~5s |
| 3 | Gaussian Decode | Pass | ~2s |

### 2. Critical Mask Format Discovery

**IMPORTANT** -- Mask must be in 0/1 format, not 0/255!

```python
# WRONG: OpenCV returns 0/255
mask = cv2.inRange(hsv, lower, upper)  # Returns 0 or 255

# CORRECT: Convert to 0/1 format
mask = (mask > 127).astype(np.uint8)  # Convert to 0 or 1
```

Reason: `merge_mask_to_rgba()` internally does `mask * 255`. If the mask is already 255, it overflows.

## Failures/Limitations

### 1. Large Image OOM (1080p+)

**FAILED** -- 16GB VRAM insufficient for processing large resolution images

| Resolution | Stage 1 | Stage 2 | Stage 3 | Result |
|-----------|---------|---------|---------|--------|
| 4480x6720 (original) | Pass | Pass | OOM | **Failed** |
| 1920x1080 | Pass | Pass | SIGKILL | **Failed** |
| 771x1024 | Pass | Pass | Pass | **Passed** |

### 2. Mesh Generation Failed

**FAILED** -- Generating both Gaussian + Mesh simultaneously causes OOM

```python
# This will OOM
decode_formats=["gaussian", "mesh"]

# Can only do this
decode_formats=["gaussian"]
```

### 3. Complex Environment Dependencies

**NOTE** -- RTX 5080 (sm_120) requires special configuration

- Requires CUDA 12.8+ (only PyTorch nightly or 2.9+ supports this)
- All CUDA extensions must be recompiled (kaolin, pytorch3d, nvdiffrast...)
- pytorch3d compilation often times out (takes 15-30 minutes)

## Working Configuration

```python
# SAM3D Inference - Configuration that works with 16GB VRAM
output = pipeline.run(
    merged,                          # RGBA image (mask in alpha channel)
    None,
    seed=42,
    with_mesh_postprocess=False,     # Skip mesh post-processing
    with_texture_baking=False,       # Skip texture baking
    with_layout_postprocess=False,   # Skip layout post-processing
    decode_formats=["gaussian"],     # Only generate Gaussian, no Mesh
)

# Save result
if "gs" in output:
    output["gs"].save_ply("output.ply")
```

## Environment Status Comparison

### Windows (Reference)

| Item | Value |
|------|-------|
| PyTorch | `2.9.1+cu128` |
| CUDA | `12.8` |
| Status | **Fully functional** |

### WSL (Current)

| Item | Value |
|------|-------|
| PyTorch | `2.9.1+cu128` |
| kaolin | `0.18.0` (installed) |
| pytorch3d | **Not installed** |
| nvdiffrast | `0.4.0` (installed) |

## Project File Structure

```
Experimental/VIGA-release/
├── result/
│   ├── 2026-02-01_greentea_sam3d/      # First test
│   ├── 2026-02-01_greentea_sam3d_v2/   # Test after mask improvement
│   ├── SAM3D_Testing_Report_WSL_20260201.html
│   └── SAM3D_Experience_Summary_WSL_20260203.html
└── utils/third_party/sam3d/
    ├── checkpoints/hf/                  # Model weights (~13GB)
    ├── demo_greentea.py                 # Full test script
    ├── demo_greentea_gs.py              # Gaussian-only generation
    └── demo_*.py                        # Other test scripts
```

## Recommendations

1. **Small images first** -- Keep input images under 1024px
2. **Gaussian only** -- Do not attempt to generate Mesh simultaneously
3. **Clean masks** -- Use morphological operations to remove noise, keep only the largest connected region
4. **Large image solution** -- Use cloud GPU (A100 40GB / H100) or wait for official optimization

---

*Generated by Arin | SAM3D Experience Summary*
*Environment: WSL (Ubuntu on Windows) | RTX 5080 (sm_120) | CUDA 12.8 | PyTorch 2.9.1*
*Date: February 3, 2026*
